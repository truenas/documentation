<nav class="sidebar-fixed">
 <h2>{{ i18n "nav_navigation" }}</h2>

  {{ partial "search" . }}
  {{ partial "search-form" . }}

  <!-- Static chatbot button -->
<div style="margin-top: 15px; margin-bottom: 10px;">
  <button id="chatbot-open-button" style="padding: 10px 20px; background-color: #0095d5; color: white; border: none; cursor: pointer; border-radius: 15px; display: flex; align-items: center; gap: 10px; transition: opacity 0.3s;">
    <span id="chatbot-button-icon" style="display: flex; vertical-align: middle;">
      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="book" class="svg-inline--fa fa-book" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 20px; height: 20px;">
        <path fill="currentColor" d="M96 0C43 0 0 43 0 96V416c0 53 43 96 96 96H384h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V384c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H384 96zm0 384H352v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"></path>
      </svg>
    </span>
    <span>AI-Powered Search</span>
  </button>
</div>

<style>
  #chatbot-open-button:hover {
    opacity: 0.8; /* Adjust the opacity for the hover effect */
  }
</style>

<!-- Chatbot Initialization Script -->
<script type="text/javascript">
  window.DocsBotAI = window.DocsBotAI || {};

  DocsBotAI.init = function(c) {
    return new Promise(function(e, o) {
      var t = document.createElement("script");
      t.type = "text/javascript";
      t.async = true;
      t.src = "https://widget.docsbot.ai/chat.js";
      var n = document.getElementsByTagName("script")[0];
      n.parentNode.insertBefore(t, n);
      t.addEventListener("load", function() {
        window.DocsBotAI.mount({
          id: c.id,
          supportCallback: c.supportCallback,
          identify: c.identify,
          options: c.options,
          signature: c.signature
        });

        // Attach the click event to the static button to open the chatbot
        document.getElementById("chatbot-open-button").addEventListener("click", function() {
          if (window.DocsBotAI.open) {
            window.DocsBotAI.open();  // Open the chatbot without toggling or changing icons
          } else {
            console.error("Chatbot open method not available.");
          }
        });

        e(); // Resolve the promise
      });
      t.addEventListener("error", function(t) {
        o(t.message);
      });
    });
  };

  DocsBotAI.init({
    id: "c6l7vGyugnoP9SSSoNXy/h6qDF4J2h3xfHKO9Nm6r",
    options: {
      customCSS: `
        .docsbot-wrapper {
          display: flex;
          flex-direction: column;
          width: 75%;
          max-width: 750px;
          max-height: 75vh;
          position: fixed;
          left: 35% !important;
          top: 10% !important;
          z-index: 1000 !important;
          box-sizing: border-box;
        }
        .docsbot-content {
          flex: 1 1 auto;
          overflow-y: auto;
        }
        .docsbot-input {
          flex-shrink: 0;
          padding: 10px;
          box-sizing: border-box;
        }
        .floating-button {
          display: none !important;
        }
        .docsbot-chat-header {
          display: flex;
          align-items: center;
          padding: 5px 10px;
          transition: height 0.3s ease, padding 0.3s ease;
        }
        .docsbot-chat-header-content {
          text-align: center;
          transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        /* Minimize header when viewport height is below 600px */
        @media (max-height: 600px) {
          .docsbot-chat-header {
            height: 50px; /* Minimized height */
            padding: 2px 5px;
          }
          .docsbot-chat-header-content h1 {
            font-size: 14px;
          }
          .docsbot-chat-header-content span {
            display: none; /* Hides the description text */
          }
        }
        
        /* Adjust layout for smaller screens (optional adjustments) */
        @media (max-width: 1200px) {
          .docsbot-wrapper {
            left: 10% !important;
            top: 10% !important;
          }
        }

        .mobile-close-button {
          display: flex !important; /* Forces the button to be visible */
          background: #0095d5;
          align-items: center;
          padding: 5px 10px;
          justify-content: center;
          border-radius: inherit;
          position: fixed;
          box-shadow: none;
        }

        .mobile-close-button:hover {
          cursor: pointer;
        }

        .mobile-close-button:hover svg {
          transform: scale(1.2);
        }

      `,
    }
  });    
</script>

<!-- Add URI Checker for DocsBot Visibility -->
<script>
    // Function to get the value of a query parameter by name
    function getSearchQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // Event listener after DocsBot Init
    window.DocsBotAI.then(function() {
        const paramValue = getSearchQueryParam('showsearch');
        if (paramValue) {
            const aibutton = document.getElementById("chatbot-button-icon");         
            // Trigger a click event on the button
            aibutton.click();
        }
    });
</script>
<!-- End URI Checker for DocsBot Visibility -->
  <section class="gdoc-nav--main">
    {{ if .Site.Params.GeekdocMenuBundle }}
      {{ partial "menu-bundle" (dict "current" . "source" .Site.Data.menu.main.main) }}
    {{ else }}
      {{ partial "menu-filetree" . }}
    {{ end }}
  </section>

  {{ if and (in (slice "posts" "tags") .Section) (default false .Site.Params.GeekdocTagsToMenu) }}
    <section class="gdoc-nav--tags">
      <h2>{{ i18n "nav_tags" }}</h2>
      <ul class="gdoc-nav__list">
        {{ $currentPage := .RelPermalink }}
        {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
          {{ with $.Site.GetPage (printf "/tags/%s" $name) }}
            <li>
              <a
                class="gdoc-nav__entry{{- if eq $currentPage .RelPermalink }}
                  {{- printf " is-active" }}
                {{- end }}"
                href="{{ .RelPermalink }}"
              >
                {{ partial "utils/title" . }}
              </a>
            </li>
          {{ end }}
        {{ end }}
      </ul>
    </section>
  {{ end }}


  <section class="gdoc-nav--more">
    {{ if .Site.Data.menu.more.more }}
      {{ partial "menu-bundle" (dict "current" . "source" .Site.Data.menu.more.more) }}
    {{ end }}
  </section>
</nav>
