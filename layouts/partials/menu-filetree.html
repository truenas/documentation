{{ $current := . }}
{{ $sortBy := default "title" .Site.Params.GeekdocFileTreeSortBy | lower }}

<!-- Static chatbot button -->
<div style="margin-top: 15px; margin-bottom: 10px;">
  <button id="chatbot-open-button" style="padding: 10px 20px; background-color: #0095d5; color: white; border: none; cursor: pointer; border-radius: 15px; display: flex; align-items: center; gap: 10px; transition: opacity 0.3s;">
    <span id="chatbot-button-icon" style="display: flex; vertical-align: middle;">
      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="book" class="svg-inline--fa fa-book" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width: 20px; height: 20px;">
        <path fill="currentColor" d="M96 0C43 0 0 43 0 96V416c0 53 43 96 96 96H384h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V384c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H384 96zm0 384H352v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48H336c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"></path>
      </svg>
    </span>
    <span>AI-Powered Search</span>
  </button>
</div>

<style>
  #chatbot-open-button:hover {
    opacity: 0.8;
  }
</style>

<!-- Navigation Menu -->
{{ template "tree-nav" dict "sect" .Site.Home.Sections "current" $current "sortBy" $sortBy }}

<!-- templates -->
{{ define "tree-nav" }}
  {{ $current := .current }}
  {{ $sortBy := .sortBy }}

  <ul class="gdoc-nav__list">
    {{ range .sect.GroupBy "Weight" }}
      {{ $rangeBy := .ByTitle }}

      {{ if eq $sortBy "linktitle" }}{{ $rangeBy = .ByLinkTitle }}
      {{ else if eq $sortBy "date" }}{{ $rangeBy = .ByDate }}
      {{ else if eq $sortBy "publishdate" }}{{ $rangeBy = .ByPublishDate }}
      {{ else if eq $sortBy "expirydate" }}{{ $rangeBy = .ByExpiryDate }}
      {{ else if eq $sortBy "lastmod" }}{{ $rangeBy = .ByLastmod }}
      {{ else if eq $sortBy "title_reverse" }}{{ $rangeBy = .ByTitle.Reverse }}
      {{ else if eq $sortBy "linktitle_reverse" }}{{ $rangeBy = .ByLinkTitle.Reverse }}
      {{ else if eq $sortBy "date_reverse" }}{{ $rangeBy = .ByDate.Reverse }}
      {{ else if eq $sortBy "publishdate_reverse" }}{{ $rangeBy = .ByPublishDate.Reverse }}
      {{ else if eq $sortBy "expirydate_reverse" }}{{ $rangeBy = .ByExpiryDate.Reverse }}
      {{ else if eq $sortBy "lastmod_reverse" }}{{ $rangeBy = .ByLastmod.Reverse }}
      {{ end }}

      {{ range $rangeBy }}
        {{ if not .Params.GeekdocHidden }}
          {{ $numberOfPages := add (len .Pages) (len .Sections) }}
          {{ $isParent := and (ne $numberOfPages 0) (not .Params.GeekdocFlatSection) }}
          {{ $isCurrent := eq $current . }}
          {{ $isAncestor := .IsAncestor $current }}
          {{ $id := substr (sha1 .Permalink) 0 8 }}
          {{ $doCollapse := and $isParent (or .Params.GeekdocCollapseSection (default false .Site.Params.GeekdocCollapseAllSections)) }}

          <li>
            <input type="checkbox" class="gdoc-nav__toggle" id="navtree-{{ $id }}" {{ if or $isCurrent $isAncestor }}checked{{ end }} />
            <label for="navtree-{{ $id }}" class="flex justify-between align-center">
              <span class="flex">
                <a href="{{ .RelPermalink }}" class="gdoc-nav__entry{{ if $isCurrent }} is-active{{ end }}">{{ partial "utils/title" . }}</a>
              </span>
            </label>
          </li>
        {{ end }}
      {{ end }}
    {{ end }}
  </ul>
{{ end }}
